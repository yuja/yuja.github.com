<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <title>Mercurial 1.8: 名前付きブランチの fast-forward マージ - tcha.org</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="/assets/style.css" media="screen">
        <link rel="alternate" type="application/atom+xml" title="tcha.org Blog" href="/blog.atom">
        <meta name="generator" content="nanoc 3.1.0">
    </head>
    <body>
        <div id="sitenav">
            <a href="/blog/">Blog</a>
            | <a href="/about/">About</a>
        </div>
        <div id="main">
            
            <div id="breadcrumbs"><a href="/">tcha.org</a> » <a href="/blog/">Blog</a> »</div>
            

            
<h1>Mercurial 1.8: 名前付きブランチの fast-forward マージ</h1>




<address class="head">
    2011 年 2 月 5 日
    <a href="http://b.hatena.ne.jp/append?http://tcha.org/blog/2011/02/05/hg-named-branch-ffmerge/"><img src="http://b.hatena.ne.jp/images/append.gif" width="16" height="12" alt="はてなブックマークへ追加" title="はてなブックマークへ追加"></a>
<a href="http://b.hatena.ne.jp/entry/http://tcha.org/blog/2011/02/05/hg-named-branch-ffmerge/"><img src="http://b.hatena.ne.jp/entry/image/http://tcha.org/blog/2011/02/05/hg-named-branch-ffmerge/" alt="はてなブックマーク - Mercurial 1.8: 名前付きブランチの fast-forward マージ" title="はてなブックマーク - Mercurial 1.8: 名前付きブランチの fast-forward マージ"></a>

    <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent('http://tcha.org/blog/2011/02/05/hg-named-branch-ffmerge/')+'&title='+encodeURIComponent('Mercurial 1.8: 名前付きブランチの fast-forward マージ'),'delicious', 'toolbar=no,width=550,height=550'); return false;"><img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Bookmark this on Delicious" title="Bookmark this on Delicious"></a>

</address>



            <p><strong>2011-03-12 追記:</strong>
<a href="http://thread.gmane.org/gmane.comp.version-control.mercurial.devel/38654/focus=38683">Mercurial 1.8.1 で元の挙動に戻りました</a> 。</p>

<p>この状態で stable とマージすると:</p>

<pre><code>o  1 tip  stable d22578dc6cbe 2011-02-05 17:26 +0900 yuya@tcha.org
|    add bar
|
@  0 8e8497c544c1 2011-02-05 17:25 +0900 yuya@tcha.org
     add foo
</code></pre>

<p>Mercurial 1.7.5 まで (と 1.8.1 以降):</p>

<pre><code>yuya /tmp/repo hg:0:8e8497c544c1/default
% hg merge stable
ファイル状態: 更新数 1、 マージ数 0、 削除数 0、 衝突未解決数 0
(マージ結果の commit を忘れずに)

yuya /tmp/repo hg:0:8e8497c544c1,1:d22578dc6cbe[tip]/default
% hg ci -m 'merge with stable'

yuya /tmp/repo hg:2:977f0fda89b9[tip]/default
% hg glog
@    2 tip :0,1 977f0fda89b9 2011-02-05 17:48 +0900 yuya@tcha.org
|\     merge with stable
| |
| o  1 stable d22578dc6cbe 2011-02-05 17:26 +0900 yuya@tcha.org
|/     add bar
|
o  0 8e8497c544c1 2011-02-05 17:25 +0900 yuya@tcha.org
     add foo
</code></pre>

<p>Mercurial 1.8 (2011 年 3 月リリース) のみ:</p>

<pre><code>yuya /tmp/repo hg:0:8e8497c544c1/default
% hg merge stable
ファイル状態: 更新数 1、 マージ数 0、 削除数 0、 衝突未解決数 0
(マージ結果の commit を忘れずに)

yuya /tmp/repo hg:1:d22578dc6cbe[tip]/default
% hg ci -m 'merge with stable'
新規ヘッドが増えました

yuya /tmp/repo hg:2:dd9675ad136d[tip]/default
% hg glog
@  2 tip  dd9675ad136d 2011-02-05 17:50 +0900 yuya@tcha.org
|    merge with stable
|
o  1 stable d22578dc6cbe 2011-02-05 17:26 +0900 yuya@tcha.org
|    add bar
|
o  0 8e8497c544c1 2011-02-05 17:25 +0900 yuya@tcha.org
     add foo
</code></pre>

<p><a href="http://felipec.wordpress.com/2011/01/16/mercurial-vs-git-its-all-in-the-branches/">名前付きブランチがコミットラベルだ</a>
ってことを思い出せば、この挙動が正しいことは分かる。
分かるんだけど、ちょっと直感に反するな。バグかと思ったよ…。</p>

<p>詳しくはこの修正を:
<a href="http://selenic.com/repo/hg/changeset/9e7e24052745">http://selenic.com/repo/hg/changeset/9e7e24052745</a></p>

            

            
            <div id="comments">
                <h2>コメント</h2>
                <div id="disqus_thread"></div>
                <script type="text/javascript" src="http://disqus.com/forums/tchaorg/embed.js"></script>
                <noscript>
                    <a href="http://disqus.com/forums/tchaorg/?url=ref">View the discussion thread.</a>
                </noscript>
                <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>

        <script type="text/javascript"><!--
            (function() {
                var links = document.getElementsByTagName('a');
                var query = '?';
                for(var i = 0; i < links.length; i++) {
                    if(links[i].href.indexOf('#disqus_thread') >= 0) {
                        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
                    }
                }
                document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/tchaorg/get_num_replies.js' + query + '"></' + 'script>');
            })();
        // --></script>
    </body>
</html>
