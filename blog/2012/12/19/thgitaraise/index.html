<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <title>TortoiseHg のエラーを出そう - TortoiseHg Advent Calendar 2012 - tcha.org</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="/assets/style.css" media="screen">
        <link rel="alternate" type="application/atom+xml" title="tcha.org Blog" href="/blog.atom">
        <meta name="generator" content="nanoc 3.1.0">
    </head>
    <body>
        <div id="sitenav">
            <a href="/blog/">Blog</a>
            | <a href="/about/">About</a>
        </div>
        <div id="main">
            
            <div id="breadcrumbs"><a href="/">tcha.org</a> » <a href="/blog/">Blog</a> »</div>
            

            
<h1>TortoiseHg のエラーを出そう - TortoiseHg Advent Calendar 2012</h1>




<address class="head">
    2012 年 12 月 19 日
    <a href="http://b.hatena.ne.jp/append?http://tcha.org/blog/2012/12/19/thgitaraise/"><img src="http://b.hatena.ne.jp/images/append.gif" width="16" height="12" alt="はてなブックマークへ追加" title="はてなブックマークへ追加"></a>
<a href="http://b.hatena.ne.jp/entry/http://tcha.org/blog/2012/12/19/thgitaraise/"><img src="http://b.hatena.ne.jp/entry/image/http://tcha.org/blog/2012/12/19/thgitaraise/" alt="はてなブックマーク - TortoiseHg のエラーを出そう - TortoiseHg Advent Calendar 2012" title="はてなブックマーク - TortoiseHg のエラーを出そう - TortoiseHg Advent Calendar 2012"></a>

    <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent('http://tcha.org/blog/2012/12/19/thgitaraise/')+'&title='+encodeURIComponent('TortoiseHg のエラーを出そう - TortoiseHg Advent Calendar 2012'),'delicious', 'toolbar=no,width=550,height=550'); return false;"><img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Bookmark this on Delicious" title="Bookmark this on Delicious"></a>

</address>



            <p><a href="http://connpass.com/event/1504/">TortoiseHg Advent Calendar 2012</a>
の 19 日目です。</p>

<p>例外をちょっとだけ楽しくする話をします。</p>

<p>何も言わずに下のコードを <a href="http://qiita.com/items/5022fe71db024b5459ff">itarize エクステンション</a>
に貼ってみましょう。</p>

<pre><code>def uisetup(ui):
    if not os.path.basename(sys.argv[0]).startswith('thg'):
        # TortoiseHg以外から読み込まれた場合は何もしない
        return

    ...

    # AnnotateViewを装飾
    from tortoisehg.hgqt.fileview import AnnotateView
    Itarate(AnnotateView)

    # -- ここから --
    from tortoisehg.hgqt import bugreport
    # 念のためサブクラス化
    class BugReportTextBrowser(bugreport.QTextBrowser):
        pass
    bugreport.QTextBrowser = BugReportTextBrowser
    Itarate(BugReportTextBrowser)
    # -- ここまで --
</code></pre>

<p>ほら、このとおり。</p>

<p><img src="/blog/2012/assets/thg-exc.jpg" alt=""></p>

<p>例外を見るのが楽しくなりますね!</p>

<p>けれど、エラーが起きた時しか表示されなくて残念です。
せっかくなのでいつでもウィンドウを開けるようにしましょう。</p>

<pre><code>    from mercurial import extensions
    from tortoisehg.hgqt import workbench
    def itaraise():
        raise Exception('hello')

    def wbrun(orig, ui, *pats, **opts):
        w = orig(ui, *pats, **opts)
        if not isinstance(w, workbench.Workbench):
            return w
        a = QtGui.QAction(u'エラーを起こす', w.menuHelp)
        a.setShortcut('F1')
        a.triggered.connect(itaraise)
        w.menuHelp.insertAction(w.menuHelp.actions()[0], a)
        return w

    extensions.wrapfunction(workbench, 'run', wbrun)
</code></pre>

<p>じゃん。</p>

<p><img src="/blog/2012/assets/thg-excmenu.png" alt=""></p>

<p>F1 キーを押すだけでエラーが起きるようになりました。</p>

<p>素晴らしいエクステンションをありがとうございます! > @wonderful_panda さん</p>

<p>それでは、良いお年を。</p>

            

            
            <div id="comments">
                <h2>コメント</h2>
                <div id="disqus_thread"></div>
                <script type="text/javascript" src="http://disqus.com/forums/tchaorg/embed.js"></script>
                <noscript>
                    <a href="http://disqus.com/forums/tchaorg/?url=ref">View the discussion thread.</a>
                </noscript>
                <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>

        <script type="text/javascript"><!--
            (function() {
                var links = document.getElementsByTagName('a');
                var query = '?';
                for(var i = 0; i < links.length; i++) {
                    if(links[i].href.indexOf('#disqus_thread') >= 0) {
                        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
                    }
                }
                document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/tchaorg/get_num_replies.js' + query + '"></' + 'script>');
            })();
        // --></script>
    </body>
</html>
