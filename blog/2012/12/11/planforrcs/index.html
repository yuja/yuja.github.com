<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <title>Plan for RCS - Mercurial Advent Calendar 2012 - tcha.org</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <link rel="stylesheet" type="text/css" href="/assets/style.css" media="screen">
        <link rel="alternate" type="application/atom+xml" title="tcha.org Blog" href="/blog.atom">
        <meta name="generator" content="nanoc 3.1.0">
    </head>
    <body>
        <div id="sitenav">
            <a href="/blog/">Blog</a>
            | <a href="/about/">About</a>
        </div>
        <div id="main">
            
            <div id="breadcrumbs"><a href="/">tcha.org</a> » <a href="/blog/">Blog</a> »</div>
            

            
<h1>Plan for RCS - Mercurial Advent Calendar 2012</h1>




<address class="head">
    2012 年 12 月 11 日
    <a href="http://b.hatena.ne.jp/append?http://tcha.org/blog/2012/12/11/planforrcs/"><img src="http://b.hatena.ne.jp/images/append.gif" width="16" height="12" alt="はてなブックマークへ追加" title="はてなブックマークへ追加"></a>
<a href="http://b.hatena.ne.jp/entry/http://tcha.org/blog/2012/12/11/planforrcs/"><img src="http://b.hatena.ne.jp/entry/image/http://tcha.org/blog/2012/12/11/planforrcs/" alt="はてなブックマーク - Plan for RCS - Mercurial Advent Calendar 2012" title="はてなブックマーク - Plan for RCS - Mercurial Advent Calendar 2012"></a>

    <a href="http://delicious.com/save" onclick="window.open('http://delicious.com/save?v=5&noui&jump=close&url='+encodeURIComponent('http://tcha.org/blog/2012/12/11/planforrcs/')+'&title='+encodeURIComponent('Plan for RCS - Mercurial Advent Calendar 2012'),'delicious', 'toolbar=no,width=550,height=550'); return false;"><img src="http://static.delicious.com/img/delicious.small.gif" height="10" width="10" alt="Bookmark this on Delicious" title="Bookmark this on Delicious"></a>

</address>



            <p><img src="/blog/2012/assets/heisei.jpg" alt="" title="新元号は平成" style="float: right;"></p>

<p><a href="http://connpass.com/event/1431/">Mercurial Advent Calendar 2012</a>
の 11 日目です。</p>

<p>RCS というバージョン管理システムをご存知でしょうか?
時は 1990 年、日本がバブル景気に沸いていた頃に使われていたツールです。
当時、湾岸戦争でナディアが 3 週飛んだことを今でも憶えています。懐かしいですね。</p>

<p>初めての人のために RCS の特徴をいくつかあげておきますね。</p>

<ul>
<li>ファイル単位</li>
<li>ロックベース</li>
<li>サーバー不要 (というかサーバーが無い)</li>
</ul>


<p>サーバー不要という点がウケて、分散バージョン管理システムが出てくるまでは
手放せなかった人も居るのではないかと思います。
CVS と Subversion の 20 年を経て、時代は分散 RCS へ回帰したのかもしれません。</p>

<p>RCS はここから入手できます。</p>

<pre><code>git clone git://git.savannah.gnu.org/rcs.git
</code></pre>

<h2>RCS to Hg</h2>

<p>さて、 RCS を Mercurial リポジトリへ変換するには、どうすればいいのでしょうか?</p>

<p>まず、簡単な方法から。</p>

<h3>CVS を経由</h3>

<p>RCS と CVS は構造がよく似ているため、 CVS に見せかけて変換することができます。</p>

<p>手順はこれだけです。</p>

<ol>
<li>CVS リポジトリを作る</li>
<li>RCS/ の管理データを CVS リポジトリへコピー</li>
<li>CVS からチェックアウト</li>
<li>hg convert で CVS to Hg の変換をかける</li>
</ol>


<p>詳しくは
<a href="http://mercurial.selenic.com/wiki/ConvertExtension#Converting_from_RCS">Converting from RCS - Mercurial Wiki</a>
を見てください。</p>

<h3>Tailor を使う</h3>

<p>RCS は単機能なため、それを補うために社内フォーマットの怪しげなファイルが
紐付いていたりしないでしょうか?</p>

<p>例えば、</p>

<ul>
<li>変更履歴を記録したテキストファイルやエクセル (manifest と changelog に相当)</li>
<li>Makefile (ファイルの追加・削除を検出)</li>
<li>ディレクトリコピーによるブランチ</li>
</ul>


<p>などを解析する必要があるかもしれません。</p>

<p>こういった手間のかかるやつをやっつけるには、
<a href="http://progetti.arstecnica.it/tailor">Tailor</a> が使えます。</p>

<p><a href="http://progetti.arstecnica.it/tailor/browser#tailor/vcpx/repository">tailor.vcpx.repository</a>
の各モジュールを参考にしながら、自分用の <code>Repository</code> と <code>UpdatableSourceWorkingDir</code>
クラスを実装しましょう。</p>

<p><code>myrcs</code> というリポジトリモジュールを書いたなら、 Tailor のプロジェクトファイル
は恐らくこんなです:</p>

<pre><code>[DEFAULT]
verbose = True
projects = foo

[foo]
target = hg:target_foo
start-revision = INITIAL
# /path/to/root の中に Tailor の状態ファイルや変換先リポジトリができる
root-directory = /path/to/root
state-file = foo.state
source = myrcs:source_foo
# /path/to/root/foo に変換先の Mercurial リポジトリができる
subdir = foo

[myrcs:source_foo]
repository = /path/to/foo/RCS

[hg:target_foo]
# 特になし
</code></pre>

<h2>まとめ</h2>

<p>変換が面倒になる前に、新しいツールへ移行しましょう。</p>

            

            
            <div id="comments">
                <h2>コメント</h2>
                <div id="disqus_thread"></div>
                <script type="text/javascript" src="http://disqus.com/forums/tchaorg/embed.js"></script>
                <noscript>
                    <a href="http://disqus.com/forums/tchaorg/?url=ref">View the discussion thread.</a>
                </noscript>
                <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
            </div>
            
        </div>

        <script type="text/javascript"><!--
            (function() {
                var links = document.getElementsByTagName('a');
                var query = '?';
                for(var i = 0; i < links.length; i++) {
                    if(links[i].href.indexOf('#disqus_thread') >= 0) {
                        query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
                    }
                }
                document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/tchaorg/get_num_replies.js' + query + '"></' + 'script>');
            })();
        // --></script>
    </body>
</html>
